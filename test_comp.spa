ExtInstImport %glsl "GLSL.std.450"

EntryPoint GLCompute %main "main"

ExecutionMode %main LocalSize 1 1 1

; Unsigned int def
TypeInt %u32T 32 0
; unsigned vec3 def
TypeVector %v3uT %u32T 3
; unsigned vec3 decl
TypePointer %v3u Input %v3uT
; var decl
Variable %GlobalInvocationId %v3i Input
; var as built-in
Decorate %GlobalInvocationId BuiltIn GlobalInvocationId

; Void def
TypeVoid %voidT
; Fn def with ret void
TypeFunction %fn_voidT %voidT 

; Float 32 def
TypeFloat %f32T 32
; Vector3 def
TypeVector %v3fT %f32T 3
TypePointer %v3f Function %v3fT

TypeStruct %lightInfoST %v3fT %v3fT %f32T
; MemberName %lightInfoST 0 "color"
; MemberName %lightInfoST 1 "direction"
; MemberName %lightInfoST 2 "intensity"
TypePointer %lightInfoS Function %lightInfoST

TypeFunction %fn_compLightT %v3fT %v3f %lightInfoS

TypeInt %i32T 32 1
Constant %i32T %%0 0
Constant %i32T %%1 1
Constant %i32T %%2 2
TypePointer %f32 Function %f32T

; fn decl
Function %voidT %main None %fn_voidT

FunctionEnd

Function %v3fT %computeLight None %fn_compLightT
FunctionParameter %position %v3f
FunctionParameter %lightInfo %lightInfoS

; Double does not create name
  Label %%label1

  Variable %v3f %direction Function

  AccessChain %v3f %%accessDirection %lightInfo %%1

  Load %v3fT %%directionS %%accessDirection
  Load %v3fT %%position %position

  FSub %v3fT %%fsub %%directionS %%position

  ExtInst %v3fT %%normalizeResult %glsl Normalize %%fsub

  Store %direction %%normalizeResult
  Load %v3fT %%direction2 %direction

  AccessChain %f32 %%accessIntensity %lightInfo %%2
  Load %f32T %%intensity %%accessIntensity
  VectorTimesScalar %v3fT %%dirIntensity %%direction2 %%intensity

  AccessChain %v3f %%accessColor %lightInfo %%0
  Load %v3fT %%color %%accessColor
  FMul %v3fT %%mulColor %%dirIntensity %%color

  ReturnValue %%mulColor

FunctionEnd